---
sidebar: sidebar 
permalink: kvm-host-configuration-and-preparation-checklist.html 
keywords: ontap select, pre-installation checklist, kvm, host preparation 
summary: Prepare cada host del hipervisor KVM donde se implemente un nodo ONTAP Select . Al preparar los hosts, evalúe cuidadosamente el entorno de implementación para asegurarse de que estén configurados correctamente y listos para la implementación de un clúster ONTAP Select . 
---
= Lista de verificación de preparación y configuración del host KVM para ONTAP Select
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Prepare cada host de hipervisor KVM donde se implemente un nodo ONTAP Select . Al preparar los hosts, evalúe cuidadosamente el entorno de implementación para asegurarse de que estén configurados correctamente y listos para la implementación de un clúster ONTAP Select .


NOTE: La utilidad de administración de ONTAP Select Deploy no realiza la configuración de red y almacenamiento necesaria de los hosts del hipervisor. Debe preparar manualmente cada host antes de implementar un clúster de ONTAP Select .



== Paso 1: Prepare el host del hipervisor KVM

Debe preparar cada servidor KVM Linux donde se implementa un nodo ONTAP Select . También debe preparar el servidor donde se implementa la utilidad de administración ONTAP Select Deploy.

.Pasos
. Instalar Red Hat Enterprise Linux (RHEL).
+
Instale el sistema operativo RHEL usando la imagen ISO. Ver ellink:reference_plan_ots_hardware.html#software-compatibility["Información de compatibilidad de software para hipervisores"] Para obtener una lista de las versiones de RHEL compatibles. configure el sistema como se indica a continuación durante la instalación:

+
.. Seleccione Predeterminado como política de seguridad.
.. Seleccione la selección de software de host virtualizado.
.. Verifique que el destino sea el disco de arranque local y no un LUN RAID utilizado por ONTAP Select.
.. Verifique que la interfaz de administración del host esté activa después de iniciar el sistema.
+

NOTE: Puedes editar el archivo de configuración de red correcto en /etc/sysconfig/network-scripts y luego activar la interfaz usando el `ifup` dominio.



. Instalar paquetes adicionales necesarios para ONTAP Select.
+
ONTAP Select requiere varios paquetes de software adicionales. La lista exacta de paquetes varía según la versión de Linux que utilice. Como primer paso, verifique que el repositorio de yum esté disponible en su servidor. Si no está disponible, puede recuperarlo utilizando el `wget your_repository_location` dominio.

+

NOTE: Es posible que algunos de los paquetes necesarios ya estén instalados si seleccionó Host virtualizado para el software durante la instalación del servidor Linux. Es posible que necesites instalar el paquete openvswitch desde el código fuente, como se describe en el siguiente documento:link:https://docs.openvswitch.org/en/latest/intro/install/general/["Documentación de Open vSwitch"^] .

+
Para obtener información adicional sobre los paquetes necesarios y otros requisitos de configuración, consulte lalink:https://imt.netapp.com/matrix/#welcome["Herramienta de matriz de interoperabilidad"^] .

. Configurar el paso a través de PCI para discos NVMe.
+
Si utiliza discos NVMe en su configuración, debe configurar el acceso directo PCI (DirectPath IO) para proporcionar acceso directo del host KVM a los discos NVMe conectados localmente en el clúster de ONTAP Select . Necesita acceso directo para realizar las siguientes tareas:

+
** link:task_chk_nvme_configure.html["Configurar el host KVM para usar unidades NVMe"]
** link:concept_stor_swraid_local.html["Utilice RAID de software después de implementar el clúster"]


+
Ver ellink:https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/5/html/virtualization/chap-virtualization-pci_passthrough#sect-Virtualization-PCI_passthrough-AI_device_to_a_host["Documentación de Red Hat"^] Para obtener instrucciones sobre cómo configurar el paso directo de PCI (DirectPath IO) para un hipervisor KVM.

. Configurar los grupos de almacenamiento.
+
Un pool de almacenamiento de ONTAP Select es un contenedor de datos lógico que abstrae el almacenamiento físico subyacente. Debe administrar los pools de almacenamiento en los hosts KVM donde se implementa ONTAP Select .





== Paso 2: Crear un grupo de almacenamiento

Cree al menos un pool de almacenamiento en cada nodo de ONTAP Select . Si utiliza RAID de software en lugar de un RAID de hardware local, se conectarán discos de almacenamiento al nodo para la raíz y los agregados de datos. En este caso, deberá crear un pool de almacenamiento para los datos del sistema.

.Antes de empezar
Verifique que pueda iniciar sesión en la CLI de Linux en el host donde está implementado ONTAP Select .

.Acerca de esta tarea
La utilidad de administración ONTAP Select Deploy espera que se especifique la ubicación de destino para el grupo de almacenamiento como `/dev/<pool_name>` , dónde `<pool_name>` es un nombre de piscina único en el host.


NOTE: Toda la capacidad del LUN se asigna cuando se crea un grupo de almacenamiento.

.Pasos
. Muestra los dispositivos locales en el host Linux y elige el LUN que contendrá el grupo de almacenamiento:
+
[source, cli]
----
lsblk
----
+
Es probable que el LUN apropiado sea el dispositivo con la mayor capacidad de almacenamiento.

. Defina el grupo de almacenamiento en el dispositivo:
+
[source, cli]
----
virsh pool-define-as <pool_name> logical --source-dev <device_name> --target=/dev/<pool_name>
----
+
Por ejemplo:

+
[listing]
----
virsh pool-define-as select_pool logical --source-dev /dev/sdb --target=/dev/select_pool
----
. Construir el grupo de almacenamiento:
+
[source, cli]
----
virsh pool-build <pool_name>
----
. Iniciar el grupo de almacenamiento:
+
[source, cli]
----
virsh pool-start <pool_name>
----
. Configure el grupo de almacenamiento para que se inicie automáticamente al arrancar el sistema:
+
[source, cli]
----
virsh pool-autostart <pool_name>
----
. Verifique que se haya creado el grupo de almacenamiento:
+
[source, cli]
----
virsh pool-list
----




== Paso 3: Opcionalmente, elimine un grupo de almacenamiento

Puedes eliminar un grupo de almacenamiento cuando ya no sea necesario.

.Antes de empezar
Verifique que pueda iniciar sesión en la CLI de Linux donde está implementado ONTAP Select .

.Acerca de esta tarea
La utilidad de administración ONTAP Select Deploy espera que se especifique la ubicación de destino para el grupo de almacenamiento como `/dev/<pool_name>` , dónde `<pool_name>` es un nombre de piscina único en el host.

.Pasos
. Verifique que el grupo de almacenamiento esté definido:
+
[source, cli]
----
virsh pool-list
----
. Destruir el grupo de almacenamiento:
+
[source, cli]
----
virsh pool-destroy <pool_name>
----
. Anular la definición de la configuración del grupo de almacenamiento inactivo:
+
[source, cli]
----
virsh pool-undefine <pool_nanme>
----
. Verifique que el grupo de almacenamiento se haya eliminado del host:
+
[source, cli]
----
virsh pool-list
----
. Verifique que se hayan eliminado todos los volúmenes lógicos del grupo de volúmenes del pool de almacenamiento.
+
.. Mostrar los volúmenes lógicos:
+
[source, cli]
----
lvs
----
.. Si existen volúmenes lógicos para el grupo, elimínelos:
+
[source, cli]
----
lvremove <logical_volume_name>
----


. Verifique que se haya eliminado el grupo de volúmenes:
+
.. Mostrar los grupos de volúmenes:
+
[source, cli]
----
vgs
----
.. Si existe un grupo de volúmenes para el pool, elimínelo:
+
[source, cli]
----
vgremove <volume_group_name>
----


. Verifique que se haya eliminado el volumen físico:
+
.. Mostrar los volúmenes físicos:
+
[source, cli]
----
pvs
----
.. Si existe un volumen físico para el grupo, elimínelo:
+
[source, cli]
----
pvremove <physical_volume_name>
----






== Paso 4: Revise la configuración del clúster ONTAP Select

Puede implementar ONTAP Select como un clúster multinodo o de un solo nodo. En muchos casos, es preferible un clúster multinodo debido a la capacidad de almacenamiento adicional y la alta disponibilidad (HA).

Las siguientes figuras ilustran las redes ONTAP Select utilizadas con un clúster de un solo nodo y un clúster de cuatro nodos para un host ESXi.

[role="tabbed-block"]
====
.Clúster de un solo nodo
--
La siguiente figura ilustra un clúster de un solo nodo. La red externa transporta el tráfico de cliente, administración y replicación entre clústeres (SnapMirror/ SnapVault).

image:CHK_01.jpg["Clúster de un solo nodo que muestra una red"]

--
.Clúster de cuatro nodos
--
La siguiente figura ilustra un clúster de cuatro nodos con dos redes. La red interna permite la comunicación entre los nodos para respaldar los servicios de red del clúster ONTAP . La red externa transporta el tráfico de cliente, administración y replicación entre clústeres (SnapMirror/ SnapVault).

image:CHK_02.jpg["Clúster de cuatro nodos que muestra dos redes"]

--
.Un solo nodo dentro de un clúster de cuatro nodos
--
La siguiente figura ilustra la configuración de red típica para una sola máquina virtual ONTAP Select dentro de un clúster de cuatro nodos. Hay dos redes independientes: ONTAP interna y ONTAP externa.

image:CHK_03.jpg["Un solo nodo dentro de un clúster de cuatro nodos"]

--
====


== Paso 5: Configurar Open vSwitch

Utilice Open vSwitch para configurar un conmutador definido por software en cada nodo de host KVM.

.Antes de empezar
Verifique que el administrador de red esté deshabilitado y que el servicio de red nativo de Linux esté habilitado.

.Acerca de esta tarea
ONTAP Select requiere dos redes independientes, las cuales utilizan la unión de puertos para proporcionar capacidad de alta disponibilidad para las redes.

.Pasos
. Verifique que Open vSwitch esté activo en el host:
+
.. Determinar si Open vSwitch se está ejecutando:
+
[source, cli]
----
systemctl status openvswitch
----
.. Si Open vSwitch no se está ejecutando, inícielo:
+
[source, cli]
----
systemctl start openvswitch
----


. Mostrar la configuración de Open vSwitch:
+
[source, cli]
----
ovs-vsctl show
----
+
La configuración aparece vacía si Open vSwitch aún no se ha configurado en el host.

. Agregar una nueva instancia de vSwitch:
+
[source, cli]
----
ovs-vsctl add-br <bridge_name>
----
+
Por ejemplo:

+
[source, cli]
----
ovs-vsctl add-br ontap-br
----
. Desactivar las interfaces de red:
+
[source, cli]
----
ifdown <interface_1>
ifdown <interface_2>
----
. Combine los enlaces utilizando el Protocolo de control de agregación de enlaces (LACP):
+
[source, cli]
----
ovs-vsctl add-bond <internal_network> bond-br <interface_1> <interface_2> bond_mode=balance-slb lacp=active other_config:lacp-time=fast
----
+

NOTE: Solo es necesario configurar un enlace si hay más de una interfaz.

. Activar las interfaces de red:
+
[source, cli]
----
ifup <interface_1>
ifup <interface_2>
----

