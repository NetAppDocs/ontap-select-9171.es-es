---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: Configuración de ONTAP Select vSwitch y políticas de equilibrio de carga para configuraciones de dos NIC y cuatro NIC. 
---
= Configuración de ONTAP Select VMware vSphere vSwitch en ESXi
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Configuración de ONTAP Select vSwitch y políticas de equilibrio de carga para configuraciones de dos NIC y cuatro NIC.

ONTAP Select admite el uso de configuraciones de vSwitch estándar y distribuido. Los vSwitches distribuidos admiten construcciones de agregación de enlaces (LACP). La agregación de enlaces es una construcción de red común que se utiliza para agregar ancho de banda entre múltiples adaptadores físicos. LACP es un estándar independiente del proveedor que proporciona un protocolo abierto para endpoints de red que agrupan grupos de puertos físicos de red en un único canal lógico. ONTAP Select puede funcionar con grupos de puertos configurados como un grupo de agregación de enlaces (LAG). Sin embargo, NetApp recomienda usar los puertos físicos individuales como puertos de enlace ascendente (troncal) simples para evitar la configuración LAG. En estos casos, las prácticas recomendadas para vSwitches estándar y distribuidos son idénticas.

Esta sección describe la configuración de vSwitch y las políticas de equilibrio de carga que se deben utilizar en configuraciones de dos NIC y de cuatro NIC.

Al configurar los grupos de puertos que usará ONTAP Select, se deben seguir las siguientes prácticas recomendadas: la política de balanceo de carga a nivel de grupo de puertos es "Enrutamiento basado en el ID del puerto virtual de origen". VMware recomienda configurar STP como Portfast en los puertos del switch conectados a los hosts ESXi.

Todas las configuraciones de vSwitch requieren un mínimo de dos adaptadores de red físicos agrupados en un único equipo de NIC. ONTAP Select admite un único enlace de 10 Gb para clústeres de dos nodos. Sin embargo, NetApp recomienda garantizar la redundancia de hardware mediante la agregación de NIC.

En un servidor vSphere, los equipos NIC son la estructura de agregación que se utiliza para agrupar varios adaptadores de red físicos en un único canal lógico, lo que permite compartir la carga de red entre todos los puertos miembros. Es importante recordar que los equipos NIC pueden crearse sin la ayuda del conmutador físico. Las políticas de balanceo de carga y conmutación por error pueden aplicarse directamente a un equipo NIC, que desconoce la configuración del conmutador ascendente. En este caso, las políticas solo se aplican al tráfico saliente.


NOTE: Los canales de puerto estáticos no son compatibles con ONTAP Select. Los canales con LACP habilitado son compatibles con vSwitches distribuidos, pero el uso de LAG LACP puede generar una distribución desigual de la carga entre los miembros del LAG.

Para clústeres de un solo nodo, ONTAP Deploy configura la máquina virtual ONTAP Select para usar un grupo de puertos para la red externa y, opcionalmente, el mismo grupo de puertos para el tráfico de administración del clúster y los nodos. En clústeres de un solo nodo, se puede agregar la cantidad deseada de puertos físicos al grupo de puertos externos como adaptadores activos.

Para clústeres multinodo, ONTAP Deploy configura cada máquina virtual de ONTAP Select para usar uno o dos grupos de puertos para la red interna y, por separado, uno o dos grupos de puertos para la red externa. El tráfico de administración de clústeres y nodos puede usar el mismo grupo de puertos que el tráfico externo o, opcionalmente, un grupo de puertos independiente. El tráfico de administración de clústeres y nodos no puede compartir el mismo grupo de puertos con el tráfico interno.


NOTE: ONTAP Select admite un máximo de cuatro VMNIC.



== vSwitch estándar o distribuido y cuatro puertos físicos por nodo

Se pueden asignar cuatro grupos de puertos a cada nodo de un clúster multinodo. Cada grupo de puertos tiene un único puerto físico activo y tres puertos físicos en espera, como se muestra en la siguiente figura.

*vSwitch con cuatro puertos físicos por nodo*

image:DDN_08.jpg["vSwitch con cuatro puertos físicos por nodo"]

El orden de los puertos en la lista de espera es importante. La siguiente tabla muestra un ejemplo de la distribución física de los puertos en los cuatro grupos.

*Configuraciones mínimas y recomendadas de red*

[cols="5*"]
|===
| Grupo Portuario | Externo 1 | Externo 2 | Interno 1 | Interno 2 


| Activo | vmnic0 | vmnic1 | vmnic2 | vmnic3 


| Modo de espera 1 | vmnic1 | vmnic0 | vmnic3 | vmnic2 


| Modo de espera 2 | vmnic2 | vmnic3 | vmnic0 | vmnic1 


| Modo de espera 3 | vmnic3 | vmnic2 | vmnic1 | vmnic0 
|===
Las siguientes figuras muestran las configuraciones de los grupos de puertos de red externos desde la interfaz de usuario de vCenter (ONTAP-External y ONTAP-External2). Tenga en cuenta que los adaptadores activos pertenecen a tarjetas de red diferentes. En esta configuración, vmnic 4 y vmnic 5 son puertos duales en la misma NIC física, mientras que vmnic 6 y vminc 7 son puertos duales similares en una NIC independiente (los vnmics 0 a 3 no se utilizan en este ejemplo). El orden de los adaptadores en espera proporciona una conmutación por error jerárquica, con los puertos de la red interna en último lugar. El orden de los puertos internos en la lista de puertos en espera se intercambia de forma similar entre los dos grupos de puertos externos.

*Parte 1: Configuraciones de grupos de puertos externos de ONTAP Select *

image:DDN_09.jpg["Parte 1: ONTAP Select"]

*Parte 2: Configuraciones de grupos de puertos externos de ONTAP Select *

image:DDN_10.jpg["Parte 2: ONTAP Select"]

Para facilitar la lectura, las asignaciones son las siguientes:

[cols="2*"]
|===
| ONTAP-Externo | ONTAP-Externo2 


| Adaptadores activos: vmnic5 Adaptadores en espera: vmnic7, vmnic4, vmnic6 | Adaptadores activos: vmnic7 Adaptadores en espera: vmnic5, vmnic6, vmnic4 
|===
Las siguientes figuras muestran las configuraciones de los grupos de puertos de red internos (ONTAP-Internal y ONTAP-Internal2). Tenga en cuenta que los adaptadores activos pertenecen a tarjetas de red diferentes. En esta configuración, vmnic 4 y vmnic 5 son puertos duales en el mismo ASIC físico, mientras que vmnic 6 y vmnic 7 son puertos duales similares en un ASIC independiente. El orden de los adaptadores en espera proporciona una conmutación por error jerárquica, con los puertos de la red externa en último lugar. El orden de los puertos externos en la lista de puertos en espera se intercambia de forma similar entre los dos grupos de puertos internos.

*Parte 1: Configuraciones del grupo de puertos internos de ONTAP Select *

image:DDN_11.jpg["Parte 1: ONTAP Select"]

*Parte 2: ONTAP Select *

image:DDN_12.jpg["Parte 2: ONTAP Select"]

Para facilitar la lectura, las asignaciones son las siguientes:

[cols="2*"]
|===
| ONTAP-Interno | ONTAP-Interno2 


| Adaptadores activos: vmnic4 Adaptadores en espera: vmnic6, vmnic5, vmnic7 | Adaptadores activos: vmnic6 Adaptadores en espera: vmnic4, vmnic7, vmnic5 
|===


== vSwitch estándar o distribuido y dos puertos físicos por nodo

Al utilizar dos tarjetas de red de alta velocidad (25/40 GB), la configuración recomendada del grupo de puertos es conceptualmente muy similar a la configuración con cuatro adaptadores de 10 GB. Se deben utilizar cuatro grupos de puertos incluso cuando solo se utilizan dos adaptadores físicos. Las asignaciones de los grupos de puertos son las siguientes:

[cols="5*"]
|===
| Grupo Portuario | Externo 1 (e0a,e0b) | Interno 1 (e0c,e0e) | Interno 2 (e0d,e0f) | Externo 2 (e0g) 


| Activo | vmnic0 | vmnic0 | vmnic1 | vmnic1 


| Apoyar | vmnic1 | vmnic1 | vmnic0 | vmnic0 
|===
*vSwitch con dos puertos físicos de alta velocidad (25/40 Gb) por nodo*

image:DDN_17.jpg["vSwitch con dos puertos físicos de alta velocidad (25/40 Gb) por nodo"]

Al utilizar dos puertos físicos (10 GB o menos), cada grupo de puertos debe tener un adaptador activo y uno en espera configurados uno frente al otro. La red interna solo está presente en clústeres multinodo de ONTAP Select . En clústeres de un solo nodo, ambos adaptadores pueden configurarse como activos en el grupo de puertos externo.

El siguiente ejemplo muestra la configuración de un vSwitch y los dos grupos de puertos responsables de gestionar los servicios de comunicación internos y externos para un clúster multinodo de ONTAP Select . La red externa puede usar la VMNIC de la red interna en caso de una interrupción de la red, ya que las VMNIC de la red interna forman parte de este grupo de puertos y están configuradas en modo de espera. En la red externa, ocurre lo contrario. Alternar las VMNIC activas y en espera entre los dos grupos de puertos es fundamental para la correcta conmutación por error de las máquinas virtuales de ONTAP Select durante las interrupciones de la red.

*vSwitch con dos puertos físicos (10 Gb o menos) por nodo*

image:DDN_13.jpg["vSwitch con dos puertos físicos por nodo"]



== vSwitch distribuido con LACP

Al utilizar vSwitches distribuidos en su configuración, se puede usar LACP (aunque no es la práctica recomendada) para simplificar la configuración de red. La única configuración LACP compatible requiere que todas las VMNIC estén en un único LAG. El switch físico de enlace ascendente debe admitir un tamaño de MTU de entre 7500 y 9000 en todos los puertos del canal. Las redes internas y externas de ONTAP Select deben estar aisladas a nivel de grupo de puertos. La red interna debe usar una VLAN no enrutable (aislada). La red externa puede usar VST, EST o VGT.

Los siguientes ejemplos muestran la configuración de vSwitch distribuido utilizando LACP.

*Propiedades LAG al utilizar LACP*

image:DDN_14.jpg["Propiedades de LAG al utilizar LACP"]

*Configuraciones de grupos de puertos externos mediante un vSwitch distribuido con LACP habilitado*

image:DDN_15.jpg["Configuraciones de grupos de puertos externos mediante un vSwitch distribuido con LACP habilitado"]

*Configuraciones de grupos de puertos internos que utilizan un vSwitch distribuido con LACP habilitado*

image:DDN_16.jpg["Configuraciones de grupos de puertos internos mediante un vSwitch distribuido con LACP habilitado"]


NOTE: LACP requiere que configure los puertos ascendentes del switch como un canal de puerto. Antes de habilitar esto en el vSwitch distribuido, asegúrese de que un canal de puerto habilitado para LACP esté configurado correctamente.
