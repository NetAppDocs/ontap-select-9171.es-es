---
sidebar: sidebar 
permalink: concept_stor_vsan_external.html 
keywords: ontap select, vsan and external array configurations, vnas architecture 
summary: 'Las implementaciones de NAS virtual (vNAS) admiten clústeres ONTAP Select en vSAN, algunos productos HCI, tecnología NetApp HCI y tipos de almacenamiento de datos de matrices externas. La infraestructura subyacente de estas configuraciones proporciona resiliencia a los almacenes de datos.' 
---
= ONTAP Select configuraciones de vSAN y de matriz externa
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Las implementaciones de NAS virtual (vNAS) admiten clústeres ONTAP Select en SAN virtual (vSAN), algunos productos HCI y tipos de almacenamiento de datos de matrices externas. La infraestructura subyacente de estas configuraciones proporciona resiliencia a los almacenes de datos.

El requisito mínimo es que el hipervisor que esté utilizando (VMware ESXi o KVM en un host Linux compatible) admita la configuración subyacente.  Si el hipervisor es ESXi, debería figurar en las listas de compatibilidad de hardware (HCL) de VMware correspondientes.



== arquitectura vNAS

La nomenclatura vNAS se utiliza en todas las configuraciones que no utilizan DAS. En el caso de clústeres multinodo de ONTAP Select , esto incluye arquitecturas en las que los dos nodos de ONTAP Select del mismo par de alta disponibilidad comparten un único almacén de datos (incluidos los almacenes de datos vSAN). Los nodos también pueden instalarse en almacenes de datos separados de la misma matriz externa compartida. Esto permite optimizar el almacenamiento del lado de la matriz para reducir el espacio ocupado por todo el par de alta disponibilidad de ONTAP Select . La arquitectura de las soluciones vNAS de ONTAP Select es muy similar a la de ONTAP Select en DAS con una controladora RAID local. Es decir, cada nodo de ONTAP Select conserva una copia de los datos de su socio de alta disponibilidad. Las políticas de eficiencia de almacenamiento de ONTAP se centran en el nodo. Por lo tanto, es preferible optimizar el almacenamiento del lado de la matriz, ya que pueden aplicarse a conjuntos de datos de ambos nodos de ONTAP Select .

También es posible que cada nodo ONTAP Select de un par de alta disponibilidad utilice una matriz externa independiente. Esta es una opción común al usar ONTAP Select Metrocluster SDS con almacenamiento externo.

Al utilizar matrices externas independientes para cada nodo de ONTAP Select , es muy importante que las dos matrices proporcionen características de rendimiento similares a la VM de ONTAP Select .



=== Arquitecturas vNAS versus DAS local con controladores RAID de hardware

La arquitectura de vNAS es, lógicamente, muy similar a la arquitectura de un servidor con DAS y una controladora RAID. En ambos casos, ONTAP Select consume espacio del almacén de datos. Este espacio se divide en VMDK, y estos VMDK forman los agregados de datos tradicionales de ONTAP . ONTAP Deploy garantiza que los VMDK tengan el tamaño correcto y se asignen al plex correcto (en el caso de pares de alta disponibilidad) durante las operaciones de creación de clústeres y adición de almacenamiento.

Existen dos diferencias principales entre vNAS y DAS con controlador RAID. La más evidente es que vNAS no requiere un controlador RAID. vNAS asume que la matriz externa subyacente proporciona la persistencia y resiliencia de datos que ofrecería un DAS con controlador RAID. La segunda diferencia, más sutil, se relaciona con el rendimiento de la NVRAM .



== NVRAM vNAS

La NVRAM de ONTAP Select es un VMDK. Esto significa que ONTAP Select emula un espacio direccionable por bytes ( NVRAM tradicional) sobre un dispositivo direccionable por bloques (VMDK). Sin embargo, el rendimiento de la NVRAM es fundamental para el rendimiento general del nodo ONTAP Select .

En las configuraciones DAS con un controlador RAID de hardware, la caché del controlador RAID de hardware actúa como caché NVRAM , ya que todas las escrituras en el VMDK de la NVRAM se alojan primero en la caché del controlador RAID.

Para arquitecturas VNAS, ONTAP Deploy configura automáticamente los nodos ONTAP Select con un argumento de arranque denominado Registro de Datos de Instancia Única (SIDL). Cuando este argumento de arranque está presente, ONTAP Select omite la NVRAM y escribe la carga útil de datos directamente en el agregado de datos. La NVRAM solo se utiliza para registrar la dirección de los bloques modificados por la operación de ESCRITURA. La ventaja de esta función es que evita una doble escritura: una en la NVRAM y otra cuando se deshabilita la NVRAM . Esta función solo está habilitada para vNAS porque las escrituras locales en la caché del controlador RAID tienen una latencia adicional insignificante.

La función SIDL no es compatible con todas las funciones de eficiencia de almacenamiento de ONTAP Select . Puede desactivarla a nivel agregado con el siguiente comando:

[listing]
----
storage aggregate modify -aggregate aggr-name -single-instance-data-logging off
----
Tenga en cuenta que el rendimiento de escritura se ve afectado si la función SIDL está desactivada. Es posible reactivarla después de que se desactiven todas las políticas de eficiencia de almacenamiento en todos los volúmenes de ese agregado:

[listing]
----
volume efficiency stop -all true -vserver * -volume * (all volumes in the affected aggregate)
----


== Colocar nodos ONTAP Select al usar vNAS en ESXi

ONTAP Select admite clústeres multinodo de ONTAP Select en almacenamiento compartido. ONTAP Deploy permite configurar varios nodos de ONTAP Select en el mismo host ESX, siempre que no formen parte del mismo clúster. Tenga en cuenta que esta configuración solo es válida para entornos VNAS (almacenes de datos compartidos). No se admiten varias instancias de ONTAP Select por host al usar almacenamiento DAS, ya que estas instancias compiten por el mismo controlador RAID de hardware.

ONTAP Deploy garantiza que la implementación inicial del clúster VNAS multinodo no coloque varias instancias de ONTAP Select del mismo clúster en el mismo host. La siguiente figura ilustra un ejemplo de una correcta implementación de dos clústeres de cuatro nodos que se intersecan en dos hosts.

*Implementación inicial de clústeres VNAS multinodo*

image:ST_14.jpg["Implementación inicial de clústeres VNAS multinodo"]

Tras la implementación, los nodos de ONTAP Select se pueden migrar entre hosts. Esto podría generar configuraciones no óptimas ni compatibles, en las que dos o más nodos de ONTAP Select del mismo clúster comparten el mismo host subyacente. NetApp recomienda la creación manual de reglas de antiafinidad de máquinas virtuales para que VMware mantenga automáticamente la separación física entre los nodos del mismo clúster, no solo entre los nodos del mismo par de alta disponibilidad (HA).


NOTE: Las reglas antiafinidad requieren que DRS esté habilitado en el clúster ESX.

Consulte el siguiente ejemplo sobre cómo crear una regla de antiafinidad para las máquinas virtuales de ONTAP Select . Si el clúster de ONTAP Select contiene más de un par de alta disponibilidad (HA), todos los nodos del clúster deben incluirse en esta regla.

image:ST_15.jpg["Reglas de máquina virtual/host"]

image:ST_16.jpg["Editar regla de VM/Host"]

Es posible que dos o más nodos ONTAP Select del mismo clúster ONTAP Select se encuentren en el mismo host ESX por uno de los siguientes motivos:

* DRS no está presente debido a limitaciones de la licencia de VMware vSphere o si DRS no está habilitado.
* La regla antiafinidad de DRS se omite porque una operación de VMware HA o una migración de máquina virtual iniciada por el administrador tiene prioridad.


Tenga en cuenta que ONTAP Deploy no supervisa de forma proactiva las ubicaciones de las máquinas virtuales de ONTAP Select . Sin embargo, una operación de actualización del clúster refleja esta configuración no compatible en los registros de ONTAP Deploy:

image:ST_17.PNG["Registros de implementación de ONTAP"]
